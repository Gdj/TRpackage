<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko">
<head>
	<title>text</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" type="text/css"  href="../../../../asset/css/trpBase.css" media="all" />
</head>


<style type="text/css">


  input.trp_validation:valid { background-color: palegreen; }      /* 유효할때 */
  input.trp_validation:invalid { background-color: lightpink; }    /* 유효하지 않을때 */
  input.trp_validation:placeholder-shown:invalid { background-color: transparent;  } /*  placeholder가 있고 유효하지 않을때 */
</style>


<body>

<div class="trp input-box">
	


	<div class="form-section mt20">
		<form id="test-form" onsubmit="return validateForm(event)">
			<div class="form-group">
				<label for="trp-tel">전화번호 (일반/휴대전화):</label>
				<input type="tel" id="trp-tel" class="trp_tel" pattern="^0\d{1,2}-?\d{3,4}-?\d{4}$" maxlength="13"
					placeholder="010-1234-5678 또는 02-1234-5678" title="일반전화 또는 휴대전화번호를 입력해주세요" required>
				<div class="help-text">
					<strong>허용되는 번호:</strong><br>
					• 휴대전화: 010-1234-5678, 011-123-4567<br>
					• 서울: 02-1234-5678, 02-123-4567<br>
					• 지역: 031-123-4567, 051-123-4567<br>
					• 인터넷전화: 070-1234-5678
				</div>
			</div>
 			<button type="submit" class="trp button type1">검증하기</button>
			<button type="button" class="trp button type1" onclick="clearPhone()">초기화</button>

			<div id="validation-result" class="validation-result"></div>

			<div id="sample-tests" style="margin-top: 20px;">
				<h4>샘플 번호 테스트</h4>
				<div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-top: 10px;">
					<button type="button" onclick="testNumber('010-1234-5678')">010-1234-5678</button>
					<button type="button" onclick="testNumber('02-1234-5678')">02-1234-5678</button>
					<button type="button" onclick="testNumber('031-123-4567')">031-123-4567</button>
					<button type="button" onclick="testNumber('070-1234-5678')">070-1234-5678</button>
					<button type="button" onclick="testNumber('01012345678')">01012345678</button>
					<button type="button" onclick="testNumber('0212345678')">0212345678</button>
				</div>
			</div>
		</form>
		<script>
			// 폼 검증 (일반전화 + 휴대전화 모두 허용)
			function validateForm(event) {
				event.preventDefault();

				const input = document.getElementById('trp-tel');
				const result = document.getElementById('validation-result');
				const value = input.value.trim();

				if (!value) {
					result.innerHTML = '<div class="invalid-msg">❌ 전화번호를 입력해주세요</div>';
					return false;
				}

				// HTML5 기본 검증
				if (!input.checkValidity()) {
					result.innerHTML = '<div class="invalid-msg">❌ ' + input.validationMessage + '</div>';
					return false;
				}

				// 통합 전화번호 패턴 (일반전화 + 휴대전화)
				const allPhonePattern = /^0\d{1,2}-?\d{3,4}-?\d{4}$/;
				const numbers = value.replace(/\D/g, '');

				if (allPhonePattern.test(value)) {
					result.innerHTML = '<div class="valid-msg">✅ 올바른 전화번호입니다!</div>';

					// 번호 분석 및 분류
					let type = '';
					let isValid = true;

					if (numbers.startsWith('010') || numbers.startsWith('011') ||
						numbers.startsWith('016') || numbers.startsWith('017') ||
						numbers.startsWith('018') || numbers.startsWith('019')) {
						type = '휴대전화';
					} else if (numbers.startsWith('02')) {
						type = '서울 일반전화';
					} else if (numbers.startsWith('070')) {
						type = '인터넷전화';
					} else if (numbers.startsWith('03') || numbers.startsWith('04') ||
						numbers.startsWith('05') || numbers.startsWith('06')) {
						type = '지역 일반전화';
					} else {
						type = '기타 전화번호';
					}

					// 길이 검증
					if ((numbers.startsWith('02') && numbers.length !== 9 && numbers.length !== 10) ||
						(!numbers.startsWith('02') && numbers.length !== 10 && numbers.length !== 11)) {
						isValid = false;
					}

					if (isValid) {
						result.innerHTML += '<div style="color: #666; font-size: 12px; margin-top: 5px;">' +
							'분류: ' + type + ' | 숫자만: ' + numbers + ' (' + numbers.length + '자리)</div>';

						// 포맷팅 제안
						const formatted = formatPhoneNumber(numbers);
						if (formatted !== value) {
							result.innerHTML += '<div style="color: #007bff; font-size: 12px;">' +
								'권장 형식: ' + formatted + '</div>';
						}
					} else {
						result.innerHTML = '<div class="invalid-msg">❌ 전화번호 길이가 올바르지 않습니다</div>';
					}

				} else {
					result.innerHTML = '<div class="invalid-msg">❌ 올바르지 않은 전화번호 형식입니다</div>';
					result.innerHTML += '<div style="color: #666; font-size: 12px; margin-top: 5px;">' +
						'입력된 값: ' + value + ' | 숫자만: ' + numbers + '</div>';
				}

				return false;
			}


			// 통합 포맷팅 함수
			function formatPhoneNumber(phone) {
				const numbers = phone.replace(/\D/g, '');

				// 11자리 휴대전화
				if (numbers.length === 11 && numbers.startsWith('01')) {
					return numbers.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
				}
				// 10자리 서울 (02)
				else if (numbers.length === 10 && numbers.startsWith('02')) {
					return numbers.replace(/(\d{2})(\d{4})(\d{4})/, '$1-$2-$3');
				}
				// 9자리 서울 (02)
				else if (numbers.length === 9 && numbers.startsWith('02')) {
					return numbers.replace(/(\d{2})(\d{3})(\d{4})/, '$1-$2-$3');
				}
				// 10자리 지역번호
				else if (numbers.length === 10 && !numbers.startsWith('02')) {
					return numbers.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3');
				}
				// 11자리 지역번호 (070 등)
				else if (numbers.length === 11 && !numbers.startsWith('01')) {
					return numbers.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
				}

				return phone; // 포맷팅 불가능한 경우 원본 반환
			}

			// 초기화
			function clearPhone() {
				document.getElementById('trp-tel').value = '';
				document.getElementById('validation-result').innerHTML = '';
			}

			// 특정 번호 테스트
			function testNumber(number) {
				document.getElementById('trp-tel').value = number;
				validateForm({
					preventDefault: () => {}
				});
			}

			// 실시간 포맷팅 (개선된 버전)
			document.getElementById('trp-tel').addEventListener('input', function (e) {
				let value = e.target.value.replace(/\D/g, '');
				let formatted = '';

				if (value.length === 0) {
					e.target.value = '';
					return;
				}

				// 서울 02번
				if (value.startsWith('02')) {
					if (value.length <= 2) {
						formatted = value;
					} else if (value.length <= 5) {
						formatted = value.replace(/(\d{2})(\d{1,3})/, '$1-$2');
					} else if (value.length <= 9) {
						formatted = value.replace(/(\d{2})(\d{3})(\d{1,4})/, '$1-$2-$3');
					} else {
						formatted = value.replace(/(\d{2})(\d{4})(\d{1,4})/, '$1-$2-$3');
					}
				}
				// 휴대전화 또는 기타
				else {
					if (value.length <= 3) {
						formatted = value;
					} else if (value.length <= 7) {
						formatted = value.replace(/(\d{3})(\d{1,4})/, '$1-$2');
					} else {
						formatted = value.replace(/(\d{3})(\d{4})(\d{1,4})/, '$1-$2-$3');
					}
				}

				e.target.value = formatted;
			});

			
		</script>
	</div>


	<div class="pattern-section">
		<div class="form-group">
			<label for="email-js">이메일 :</label>
			<input type="email" id="email-js"
							placeholder="실시간 JavaScript 검증"
							title="실시간으로 검증됩니다">
			<div id="js-result" class="help-text"></div>
		</div>
			<script>
				// 이메일 검증 함수들 (향상된 버전)
				function isValidEmail(email) {
					// 도메인 확장자 필수 패턴 (최소 2글자)
					const basicPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
					return basicPattern.test(email);
				}

				function validateEmailDomain(email) {
					if (!email.includes('@')) return false;

					const domain = email.split('@')[1];
					if (!domain) return false;

					// 도메인에 최소 하나의 점(.)이 있어야 함
					if (!domain.includes('.')) return false;

					// 점(.) 뒤에 최소 2글자의 확장자가 있어야 함
					const parts = domain.split('.');
					const extension = parts[parts.length - 1];

					return extension && extension.length >= 2 && /^[a-zA-Z]+$/.test(extension);
				}

				// 초기화
				function clearEmail() {
					document.getElementById('email-test').value = '';
					document.getElementById('email-validation-result').innerHTML = '';
				}

				// JavaScript 실시간 검증 (향상된 버전)
				document.getElementById('email-js').addEventListener('input', function (e) {
					const email = e.target.value;
					const result = document.getElementById('js-result');

					if (email.length === 0) {
						result.textContent = '';
						e.target.style.borderColor = '#ddd';
						return;
					}

					const isValid = isValidEmail(email);
					const isDomainValid = validateEmailDomain(email);

					if (isValid && isDomainValid) {
						e.target.style.borderColor = '#28a745';
						result.innerHTML = '<span style="color: #28a745;">✅ 유효한 이메일 형식</span>';

						if (email.includes('@')) {
							const provider = getEmailProvider(email);
							result.innerHTML += ' - ' + provider;
						}
					} else {
						e.target.style.borderColor = '#dc3545';

						if (!email.includes('@')) {
							result.innerHTML = '<span style="color: #dc3545;">❌ @ 기호가 필요합니다</span>';
						} else if (!isDomainValid) {
							const domain = email.split('@')[1] || '';
							if (!domain.includes('.')) {
								result.innerHTML = '<span style="color: #dc3545;">❌ 도메인 확장자가 필요합니다 (예: .com)</span>';
							} else {
								result.innerHTML = '<span style="color: #dc3545;">❌ 올바른 도메인 확장자를 입력하세요</span>';
							}
						} else {
							result.innerHTML = '<span style="color: #dc3545;">❌ 유효하지 않은 형식</span>';
						}
					}
				});
			</script>

	</div>

</body>
</html>